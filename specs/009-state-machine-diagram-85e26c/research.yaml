# Research Artifact (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: state-machine-diagram-85e26c
summary: >
  This is a pure content task requiring no code changes. The implementation is a single
  markdown file using Mermaid stateDiagram-v2 syntax, natively rendered by GitHub with
  no plugins or dependencies. All technical decisions are trivially resolved: use
  stateDiagram-v2 (not v1), a sheep lifecycle theme matching the repo's existing content
  files, and a title-only heading consistent with JOKE.md and SHEEP.md conventions.

# Relationships
relatedFeatures:
  - joke-markdown
  - sheep-story

technologies:
  - Markdown
  - Mermaid stateDiagram-v2

relatedLinks:
  - https://mermaid.js.org/syntax/stateDiagram.html
  - https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/creating-diagrams

# Structured technology decisions
decisions:
  - title: 'Diagram Syntax: stateDiagram-v2 vs alternatives'
    chosen: 'stateDiagram-v2'
    rejected:
      - 'stateDiagram (v1) — older syntax, less expressive, worse GitHub rendering, labelled transitions use a different arrow style'
      - 'flowchart LR — general-purpose flowchart; no native [*] initial/terminal state syntax, making it semantically incorrect for a state machine'
    rationale: >
      stateDiagram-v2 is the current recommended Mermaid syntax for state machines. It
      natively supports [*] as initial and terminal pseudo-states, labelled transitions
      via the : notation, and renders cleanly on GitHub without any configuration.
      The spec explicitly requires stateDiagram-v2 (FR-2, NFR-2), so this is a
      requirement-driven decision with no ambiguity.

  - title: 'File Placement and Naming Convention'
    chosen: 'STATE_MACHINE.md at repository root, UPPERCASE name'
    rejected:
      - 'docs/STATE_MACHINE.md — no docs/ directory exists in this repo; all content files live at root; would break pattern consistency'
      - 'state-machine.md (lowercase-hyphenated) — repo uses UPPERCASE.md for all content files (JOKE.md, SHEEP.md, DESIGN_PATTERN.md, README.md)'
    rationale: >
      Existing content files in this repo (JOKE.md, JOKE2.md, SHEEP.md, DESIGN_PATTERN.md,
      README.md) all follow UPPERCASE naming at the repository root. STATE_MACHINE.md
      matches this established pattern and satisfies NFR-3. No precedent exists for
      subdirectory placement of content files.

  - title: 'File Structure: Heading Style and Prose'
    chosen: 'Single level-1 heading only (# Sheep State Machine), no prose body'
    rejected:
      - 'Level-2 heading — level-1 is more conventional for a standalone document and matches SHEEP.md (# A Sheep Story) and JOKE.md (# Joke)'
      - 'Heading plus description paragraph — adds lines without value; resolved open question in spec mandates title-only (FR-7, NFR-1); diagram is self-explanatory'
    rationale: >
      JOKE.md and SHEEP.md both use a single level-1 heading with minimal surrounding
      text. A title-only approach is consistent with this terse content style, satisfies
      the "fast, no thinking" user intent, and keeps the file well within the 30-line
      limit (NFR-1). The Mermaid diagram itself is self-documenting through its state
      labels and transition labels.

  - title: 'State Selection for Sheep Lifecycle'
    chosen: 'Five states: Grazing, Wandering, Shearing, Sleeping — with [*] initial and terminal'
    rejected:
      - 'Three states (Grazing → Shearing → [*]) — too sparse to demonstrate meaningful transitions; spec requires 4–5 named states (FR-4)'
      - 'Six or more states — violates the "simple short" user intent and risks exceeding the 30-line limit (NFR-1); 4–5 is the specified range'
    rationale: >
      The sheep lifecycle naturally maps to four states under 20 characters each (NFR-5):
      Grazing, Wandering, Shearing, and Sleeping. These allow a loop (Grazing ↔ Wandering),
      a branch to Shearing, and a terminal transition from Sleeping. All labels are
      plain English (NFR-4) and consistent with the SHEEP.md narrative. Using [*] as
      both initial and terminal pseudo-state satisfies FR-3.

# Open questions (should be resolved by end of research)
openQuestions:
  - question: 'Should the diagram include Mermaid note annotations on any state?'
    resolved: true
    options:
      - option: 'No notes — transitions only'
        description: >
          Keep the diagram purely structural with states and transitions. Notes add
          visual noise and extra lines that push toward the 30-line limit. The spec
          does not require notes and KISS principle applies.
        selected: true
      - option: 'One note on the initial state'
        description: >
          A single Mermaid note block (note right of Grazing: ...) adds flavour but
          consumes 3 extra lines and risks approaching the 30-line NFR-1 limit for
          marginal descriptive gain.
        selected: false
      - option: 'Notes on all states'
        description: >
          Maximally descriptive but would roughly double the line count, violate NFR-1,
          and contradict the "simple short" user intent. Clearly out of scope.
        selected: false
    selectionRationale: >
      The spec (NFR-1) requires the file to stay under 30 lines. Notes consume 3+ lines
      each and provide no functional value for a content-only file. Transitions with
      human-readable labels (NFR-4) are sufficient to make the diagram self-explanatory.
      The existing content files (JOKE.md, SHEEP.md) favour minimalism.
    answer: 'No notes — transitions only'

# Markdown content (the full research document)
content: |
  ## Status

  - **Phase:** Research
  - **Updated:** 2026-02-26

  ## Technology Decisions

  ### 1. Diagram Syntax: stateDiagram-v2

  **Chosen:** `stateDiagram-v2` Mermaid directive

  **Rejected:**
  - `stateDiagram` (v1) — older syntax with worse GitHub rendering and no advantages over v2
  - `flowchart LR` — semantically wrong for a state machine; lacks native `[*]` pseudo-state support

  **Rationale:** stateDiagram-v2 is the current Mermaid standard for state diagrams.
  GitHub natively renders it with no plugins. The spec explicitly mandates this syntax
  (FR-2, NFR-2). Transition labels use the `: label` suffix notation, e.g.:
  `Grazing --> Wandering : feels restless`.

  ### 2. File Naming and Placement

  **Chosen:** `STATE_MACHINE.md` at repo root

  **Rejected:**
  - `docs/STATE_MACHINE.md` — no `docs/` directory exists; all content files are at root
  - `state-machine.md` — repo uses UPPERCASE convention (JOKE.md, SHEEP.md, DESIGN_PATTERN.md)

  **Rationale:** Pattern matching with existing files is unambiguous. Root placement
  with UPPERCASE naming is the established convention in this repository.

  ### 3. File Structure

  **Chosen:** Single `# Sheep State Machine` heading + Mermaid fenced code block

  **Rejected:**
  - Level-2 heading — level-1 matches existing files (SHEEP.md, JOKE.md)
  - Heading + prose — unnecessary; diagram labels are self-documenting; contradicts user intent

  **Rationale:** JOKE.md and SHEEP.md establish the minimal heading style. The diagram
  labels are sufficient to communicate meaning without additional prose.

  ### 4. State Selection

  **Chosen:** 4 named states (Grazing, Wandering, Shearing, Sleeping) with labelled transitions

  **Rejected:**
  - 3 states — below the minimum richness threshold specified in FR-4
  - 6+ states — exceeds "simple short" constraint and risks NFR-1 line limit violation

  **Rationale:** The sheep domain (consistent with SHEEP.md narrative) provides natural
  states all under 20 characters (NFR-5), using plain English (NFR-4). The lifecycle
  creates a coherent loop: Grazing ↔ Wandering, with branches to Shearing and Sleeping,
  and a terminal transition from Sleeping.

  ## Library Analysis

  | Library | Purpose | Decision | Reasoning |
  | ------- | ------- | -------- | --------- |
  | Mermaid stateDiagram-v2 | State machine diagram rendering | Use | Native GitHub support, zero install, spec mandates it |
  | Mermaid flowchart | General diagrams | Reject | Semantically wrong for state machines; no [*] pseudo-states |
  | PlantUML | Alternative diagram tool | Reject | Requires server-side rendering; not natively supported by GitHub |
  | ASCII art | Text-based diagram | Reject | Not machine-readable, hard to maintain, no semantic structure |

  ## Security Considerations

  None. This is a static markdown content file with no executable code, no user input,
  no API calls, and no dependencies. Mermaid is rendered client-side by GitHub's
  infrastructure — no security surface is introduced by this file.

  ## Performance Implications

  None. A ~20-line markdown file has no meaningful performance characteristics.
  GitHub renders Mermaid diagrams lazily. The diagram contains 4 states and ~6
  transitions, which is trivially fast for any Mermaid renderer.

  ## Architecture Notes

  This feature adds a new file to the repository root content layer — the same layer
  as JOKE.md, JOKE2.md, SHEEP.md, and DESIGN_PATTERN.md. It does not interact with
  the `src/` Python package, `tests/`, `docker-compose.yml`, or any other infrastructure.
  No existing files are modified (FR-8). The implementation is a single Write operation
  producing approximately 20 lines of Markdown + Mermaid content.

  Proposed diagram structure:

  ```
  # Sheep State Machine

  ```mermaid
  stateDiagram-v2
      [*] --> Grazing
      Grazing --> Wandering : feels restless
      Wandering --> Grazing : finds good grass
      Wandering --> Shearing : farmer appears
      Shearing --> Sleeping : exhausted after shearing
      Sleeping --> Grazing : fully rested
      Sleeping --> [*] : winter comes
  ```
  ```

  This satisfies all functional requirements: 4 named states (FR-4), labelled transitions
  (FR-5), sheep domain (FR-6), initial and terminal pseudo-states (FR-3), level-1
  heading (FR-7), and fits comfortably within 30 lines (NFR-1).
