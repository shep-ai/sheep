# Feature Specification (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: state-machine-diagram
number: 009
branch: feat/009-state-machine-diagram
oneLiner: Add a markdown file with a Mermaid state machine diagram
summary: >
  Create a short markdown file (STATE_MACHINE.md) at the repo root containing a
  Mermaid stateDiagram-v2 diagram of a simple, original state machine. Follows the
  same convention as existing content files (DESIGN_PATTERN.md, JOKE.md, SHEEP.md):
  a title heading, a brief prose introduction, and the diagram body.
phase: Requirements
sizeEstimate: S

# Relationships
relatedFeatures: []

technologies:
  - Markdown
  - Mermaid (stateDiagram-v2)

relatedLinks: []

openQuestions:
  - question: 'What real-world domain should the state machine model?'
    resolved: true
    options:
      - option: 'Traffic light cycle'
        description: >
          Classic, universally understood example (Red → Green → Yellow → Red).
          Immediately recognizable but somewhat overused in documentation examples.
          Requires no explanation of the domain.
        selected: false
      - option: 'Vending machine'
        description: >
          Slightly more interesting than a traffic light; models idle, coin-inserted,
          item-selected, dispensing, and change-returned states. Good for showing
          multiple transitions and a non-trivial flow, but still familiar enough
          to need no preamble.
        selected: false
      - option: 'Order fulfillment lifecycle'
        description: >
          Models an e-commerce order moving through placed → payment_pending →
          paid → shipped → delivered, with a cancelled terminal state. Relatable,
          realistic, shows fork-like branching (cancel can happen from multiple
          states), and produces a diagram with 5–7 states — substantial without
          being complex. Consistent with the "interesting but accessible" tone of
          existing content files.
        selected: true
    selectionRationale: >
      Order fulfillment is relatable for any developer, demonstrates realistic
      branching (cancellation from multiple states), and produces a diagram with
      enough states (5–6) to be illustrative without being overwhelming. It avoids
      the overused traffic-light cliché while remaining instantly understandable.
    answer: 'Order fulfillment lifecycle'

  - question: 'How many states should the diagram contain?'
    resolved: true
    options:
      - option: 'Minimal (3–4 states)'
        description: >
          Keeps the diagram tiny and the file short. Easy to read at a glance,
          but may feel too trivial to be genuinely instructive.
        selected: false
      - option: 'Moderate (5–7 states)'
        description: >
          Enough states to show realistic branching, a happy path, and at least
          one terminal error/cancel state. Still fits comfortably in a single
          screen. Best balance of clarity and usefulness.
        selected: true
      - option: 'Complex (8+ states)'
        description: >
          Demonstrates advanced stateDiagram-v2 features (nested states,
          concurrent regions) but risks being hard to parse in a small markdown
          file and diverges from the "short, focused" convention of existing files.
        selected: false
    selectionRationale: >
      5–7 states hits the sweet spot: demonstrates non-trivial branching and
      real-world relevance without overwhelming the reader or ballooning the file
      size beyond the ~30-line target.
    answer: 'Moderate (5–7 states)'

  - question: 'Should the diagram include state notes or descriptions?'
    resolved: true
    options:
      - option: 'Diagram only'
        description: >
          The file contains only the title, a one-sentence prose intro, and the
          Mermaid code block. Minimal, consistent with the brevity of JOKE.md and
          SHEEP.md. No risk of over-explaining.
        selected: true
      - option: 'Diagram with inline notes'
        description: >
          Adds Mermaid note syntax inside the diagram to annotate key transitions
          or states. Adds visual interest but increases diagram complexity and
          line count.
        selected: false
      - option: 'Diagram with a prose legend'
        description: >
          Follows the diagram with a markdown table or bullet list explaining each
          state. More tutorial-like, but inconsistent with the terse style of
          existing content files.
        selected: false
    selectionRationale: >
      Existing content files (JOKE.md, SHEEP.md, DESIGN_PATTERN.md) are terse —
      a heading, a brief intro sentence, and the content. Adding notes or a legend
      deviates from that convention and inflates scope. A well-chosen domain
      (order fulfillment) is self-explanatory without annotation.
    answer: 'Diagram only'

# Markdown content (the actual spec)
content: |
  ## Problem Statement

  The repository lacks an example of a state machine diagram. The request is to
  create a simple, standalone markdown file (STATE_MACHINE.md) with a Mermaid
  stateDiagram-v2 diagram — no external dependencies, just a focused content
  addition that follows the same conventions as existing files.

  ## Success Criteria

  - [ ] A file named `STATE_MACHINE.md` exists at the repository root
  - [ ] The file contains a level-1 heading (`# ...`) as its first line
  - [ ] The file contains a short prose introduction (1–3 sentences) before the diagram
  - [ ] The file contains exactly one fenced Mermaid code block using `stateDiagram-v2` syntax
  - [ ] The diagram has between 5 and 7 named states (excluding `[*]` start/end pseudostates)
  - [ ] The diagram includes at least one terminal state (a state that transitions to `[*]`)
  - [ ] The diagram includes at least one branching point (a state with 2+ outgoing transitions)
  - [ ] The Mermaid syntax is valid and renders without errors on GitHub
  - [ ] The file is ≤ 50 lines
  - [ ] No existing files are modified

  ## Functional Requirements

  - **FR-1**: A new file `STATE_MACHINE.md` MUST be created at the repository root.
  - **FR-2**: The file MUST open with a single level-1 Markdown heading that names or
    describes the state machine (e.g., `# Order Fulfillment State Machine`).
  - **FR-3**: The file MUST include 1–3 sentences of prose after the heading that briefly
    describe the scenario being modeled, before the diagram.
  - **FR-4**: The file MUST contain a fenced code block with language tag `mermaid` containing
    a `stateDiagram-v2` diagram.
  - **FR-5**: The diagram MUST define between 5 and 7 named states (not counting `[*]`).
  - **FR-6**: The diagram MUST include a start pseudostate (`[*]`) with a transition to the
    initial state, and at least one transition from a terminal state back to `[*]`.
  - **FR-7**: The diagram MUST include at least one state with two or more outgoing transitions
    (a branching/decision point), to demonstrate non-trivial flow.
  - **FR-8**: The modeled domain MUST be the order fulfillment lifecycle (placed → payment
    pending → paid → shipped → delivered, with a cancellation path).
  - **FR-9**: No existing files at the repository root or elsewhere MUST be modified.

  ## Non-Functional Requirements

  - **NFR-1 — Renderability**: The Mermaid syntax MUST be valid `stateDiagram-v2` and render
    correctly on GitHub without any additional tooling or build steps.
  - **NFR-2 — Brevity**: The file MUST be ≤ 50 lines, consistent with the "short and focused"
    convention of existing content files (JOKE.md, SHEEP.md, DESIGN_PATTERN.md).
  - **NFR-3 — Consistency**: The file structure (heading → prose intro → content) MUST match
    the pattern established by existing root-level markdown content files.
  - **NFR-4 — Readability**: State names MUST use `snake_case` or short readable labels
    consistent with Mermaid conventions; transitions MUST have descriptive labels where the
    trigger is non-obvious.
  - **NFR-5 — Self-containment**: The file MUST be fully standalone — no links, imports, or
    references to external resources are required to understand it.

  ## Product Questions & AI Recommendations

  | # | Question | AI Recommendation | Rationale |
  | - | -------- | ----------------- | --------- |
  | 1 | What real-world domain should the state machine model? | Order fulfillment lifecycle | Relatable, shows realistic branching (cancellation), avoids overused traffic-light cliché |
  | 2 | How many states should the diagram contain? | Moderate (5–7 states) | Demonstrates non-trivial flow without overwhelming the reader or inflating file size |
  | 3 | Should the diagram include state notes or descriptions? | Diagram only | Consistent with terse style of existing content files; well-chosen domain is self-explanatory |

  ## Affected Areas

  | Area | Impact | Reasoning |
  | ---- | ------ | --------- |
  | `STATE_MACHINE.md` (new file, repo root) | Low | New standalone content file, no code changes |

  ## Dependencies

  None. Mermaid diagrams are rendered natively by GitHub and most markdown viewers.

  ## Size Estimate

  **S** — Single new markdown file, ≤ 50 lines. No code changes, no tests needed.
  Requirements analysis confirms original estimate; structured product questions add
  no implementation complexity.
