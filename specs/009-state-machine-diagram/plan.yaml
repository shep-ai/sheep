# Implementation Plan (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: state-machine-diagram
summary: >
  Single-phase plan to create STATE_MACHINE.md at the repo root — a terse markdown file
  containing a Mermaid stateDiagram-v2 diagram of an order fulfillment lifecycle. No code
  changes, no dependencies, no build steps. The file follows the heading→prose→content
  convention established by JOKE.md and SHEEP.md.

# Relationships
relatedFeatures: []

technologies:
  - Markdown
  - Mermaid stateDiagram-v2

relatedLinks:
  - https://mermaid.js.org/syntax/stateDiagram.html
  - https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/creating-diagrams

phases:
  - id: phase-1
    name: 'Content Creation'
    description: >
      Create STATE_MACHINE.md at the repository root with a valid stateDiagram-v2
      Mermaid diagram of the order fulfillment lifecycle. This is the only phase —
      the entire feature is a single atomic file addition with no dependencies on
      other work and no risk of conflict.
    parallel: false

filesToCreate:
  - STATE_MACHINE.md

filesToModify: []

openQuestions: []

content: |
  ## Architecture Overview

  This feature is a pure content addition. The repository already contains a pattern
  of terse root-level markdown files that serve as standalone illustrative content:

  - `JOKE.md` (~14 lines) — heading + prose + joke
  - `SHEEP.md` (~4 lines) — heading + short prose
  - `DESIGN_PATTERN.md` (~237 lines) — long-form reference (different tier, not the target)

  `STATE_MACHINE.md` fits the short-form tier: a single level-1 heading, 1–3 sentences of
  prose context, and one fenced Mermaid code block. No links, no imports, no modifications
  to existing files. GitHub renders `stateDiagram-v2` natively, so no build tooling or CI
  configuration is required.

  ## Key Design Decisions

  ### 1. File Structure: Terse Tier (heading → prose → diagram)

  **Chosen:** Level-1 heading + 1–3 sentence prose intro + single fenced Mermaid block.

  Rejected: DESIGN_PATTERN.md-style multi-section format — too verbose; spec targets ≤50 lines.
  Rejected: Diagram-only (no prose) — violates FR-3 and the established heading→intro→content
  pattern confirmed by reading JOKE.md and SHEEP.md.

  The terse tier satisfies FR-2, FR-3, NFR-2, and NFR-3 simultaneously.

  ### 2. Diagram Syntax: stateDiagram-v2

  **Chosen:** `stateDiagram-v2` (current Mermaid syntax).

  Rejected: `stateDiagram` v1 — deprecated in recent Mermaid versions.
  Rejected: `flowchart`/`graph TD` — semantically incorrect for state machines; lacks [*]
  pseudostate support required by FR-6.

  FR-4 mandates stateDiagram-v2; v2 also has better GitHub rendering and is future-safe.

  ### 3. State Naming: snake_case Identifiers

  **Chosen:** `snake_case` identifiers used directly as state names (no aliasing needed).

  Rejected: CamelCase — unconventional in Mermaid; less readable.
  Rejected: Space-separated labels as identifiers — requires quoting; error-prone.

  NFR-4 explicitly calls for snake_case. All six domain state names are readable as-is:
  `placed`, `payment_pending`, `paid`, `shipped`, `delivered`, `cancelled`.

  ### 4. Topology: 6 States with Cancellation Branching

  **Chosen:** 6 named states; happy path + cancellation branch from three states.

  ```
  [*] → placed → payment_pending → paid → shipped → delivered → [*]
         ↓               ↓           ↓
         └───────── cancelled ─────────┘
                         ↓
                        [*]
  ```

  Rejected: Adding a "refunded" state — unnecessary 7th state, adds complexity without value.
  Rejected: Merging `payment_pending` + `paid` — reduces branching; risks failing FR-5 minimum.

  6 states hits the mid-range of the 5–7 target (FR-5). Cancellation from three states
  provides meaningful branching (FR-7). Two terminal states (`delivered`, `cancelled`)
  both transition to `[*]` (FR-6).

  ### 5. Transition Labels: Action Verbs on Non-Obvious Transitions

  **Chosen:** Action verbs (e.g., "pay", "ship", "cancel") only where the trigger is
  not implied by the state names alone.

  Rejected: Past-tense event names ("payment submitted") — verbose and less idiomatic.
  Rejected: No labels at all — NFR-4 requires labels where the trigger is non-obvious.

  Action verbs are the conventional style in Mermaid documentation and are most readable
  at a glance. The `placed → payment_pending` and `payment_pending → paid` transitions
  benefit from brief labels; `shipped → delivered` is self-evident and can be unlabeled.

  ## Implementation Strategy

  The implementation is a single atomic step: write STATE_MACHINE.md. There are no
  sequencing dependencies, no risk of breaking existing functionality, and no configuration
  changes. The one task covers authoring the file, self-reviewing it against every acceptance
  criterion in the spec, and verifying the Mermaid syntax is well-formed.

  Phase ordering: only one phase (Content Creation) is needed.

  ## Risk Mitigation

  | Risk | Mitigation |
  | ---- | ---------- |
  | Invalid Mermaid syntax fails to render on GitHub | Manually validate syntax against stateDiagram-v2 spec; check state count, transition arrows, and [*] pseudostate usage before committing |
  | File exceeds 50-line limit | Count lines before committing; 6 states + transitions fit comfortably within ~25 lines of diagram code |
  | State count falls outside 5–7 range | Count named states (excluding [*]) explicitly; current topology is exactly 6 |
  | Accidental modification of existing files | Only `STATE_MACHINE.md` is created; all other files are untouched |
